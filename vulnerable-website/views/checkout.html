<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - ShopHub</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="navbar">
        <div class="container">
            <a href="/" class="logo">ShopHub</a>
            <div class="nav-links">
                <a href="/shop">Shop</a>
                <a href="/orders">My Orders</a>
                <a href="#" onclick="logout()">Logout</a>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="checkout-form">
            <h2>Checkout</h2>
            <form id="checkoutForm">
                <div class="form-group">
                    <label for="product_id">Select Product</label>
                    <select id="product_id" name="product_id" class="form-control" onchange="updatePrice()">
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="engraving_colors">Engraving Colors (Select multiple with Ctrl/Cmd)</label>
                    <select id="engraving_colors" name="engraving_colors" class="form-control" multiple size="4">
                        <option value="gold">Gold</option>
                        <option value="silver">Silver</option>
                        <option value="black">Black</option>
                        <option value="red">Red</option>
                        <option value="blue">Blue</option>
                        <option value="green">Green</option>
                    </select>
                    <small style="color: #666; font-size: 0.8rem;">Hold Ctrl/Cmd to select multiple colors</small>
                </div>

                <div class="form-group">
                    <label for="base_price">Base Price ($)</label>
                    <input type="number" id="base_price" name="base_price" class="form-control" value="100" min="1" readonly>
                </div>

                <div class="form-group">
                    <label for="quantity">Quantity</label>
                    <input type="number" id="quantity" name="quantity" class="form-control" value="1" min="1" required>
                </div>

                <div class="form-group">
                    <label for="discount_code">Discount Code</label>
                    <select id="discount_code" name="discount_code" class="form-control">
                        <option value="">No discount</option>
                        <option value="SAVE10">SAVE10 (10% off)</option>
                        <option value="SAVE20">SAVE20 (20% off)</option>
                        <option value="FREESHIP">FREESHIP (Free shipping)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="shipping_method">Shipping Method</label>
                    <select id="shipping_method" name="shipping_method" class="form-control">
                        <option value="standard">Standard Shipping ($5)</option>
                        <option value="express">Express Shipping ($15)</option>
                        <option value="overnight">Overnight Shipping ($25)</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-block">Process Order</button>
            </form>
        </div>

        <div class="loading" id="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Processing your order...</p>
        </div>

        <div class="results" id="results" style="display: none;">
        </div>
    </div>

    <script>
        async function loadProducts() {
            try {
                const response = await fetch('/products');
                const products = await response.json();
                
                const productSelect = document.getElementById('product_id');
                const urlParams = new URLSearchParams(window.location.search);
                const preselectedProductId = urlParams.get('product_id');
                
                products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = `${product.name} - $${product.price}`;
                    if (product.id == preselectedProductId) {
                        option.selected = true;
                    }
                    productSelect.appendChild(option);
                });
                
                if (preselectedProductId) {
                    updatePrice();
                }
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        function updatePrice() {
            const productSelect = document.getElementById('product_id');
            const basePriceInput = document.getElementById('base_price');
            const selectedProductId = productSelect.value;
            
            if (selectedProductId) {
                fetch(`/products/${selectedProductId}`)
                    .then(response => response.json())
                    .then(product => {
                        basePriceInput.value = product.price;
                    })
                    .catch(error => {
                        console.error('Error fetching product:', error);
                    });
            }
        }

        function logout() {
            fetch('/api/logout', { method: 'POST' })
                .then(() => window.location.href = '/');
        }

        document.addEventListener('DOMContentLoaded', loadProducts);
    </script>
    <script src="/js/checkout.js"></script>
</body>
</html>
